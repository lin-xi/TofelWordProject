<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="Copyright" content="Linxi" />
    <meta name="Description" content="托福记单词" />
    <meta name="Keywords" content="托福记单词" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <title>托福记单词</title>

    <link rel="stylesheet" href="css/mobile.css" />
    <link rel="stylesheet" href="css/page.css" />
    <link rel="stylesheet" href="css/icon.css" />

</head>

<body>
    <div class="app-box">
        <!--首页开始 -->
        <div class="page-box" id="index">
            <div class="page-header">
                <a href="#index"><i class="icon-home"></i></a>
                <h3>托福单词</h3>
            </div>
            <div class="page-content">
                <ul class="user-info">
                    <li>
                        <img class="avatar" src="images/avatar.png"/>
                    </li>
                    <li>
                        <p class="p1">已记忆</p>
                        <p class="total-word" id="totalWord">2200</p>
                    </li>
                </ul>
                <ul class="word-info">
                    <li>
                        <div class="score-wraper1">
                            <div class="score">
                                <div class="de"><div class="den"><div class="dene"><div class="denem"><div class="deneme" id="unitNumber">3</div></div></div></div></div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="score-wraper1">
                            <div class="score">
                                <div class="de"><div class="den"><div class="dene"><div class="denem"><div class="deneme" id="unitNumber">3</div></div></div></div></div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="score-wraper1">
                            <div class="score">
                                <div class="de"><div class="den"><div class="dene"><div class="denem"><div class="deneme" id="unitNumber">3</div></div></div></div></div>
                            </div>
                        </div>
                    </li>
                </ul>

                <div class="main-menu">
                    <ul>
                        <li id="wordunit" class="menu-item index"><span class="icon i-word"></span><span class="menu-text">记单词</span></li>
                        <li id="statistic" class="menu-item statistic"><span class="icon i-statistic"></span><span class="menu-text">统计</span></li>
                    </ul>
                    <ul>
                        <li id="setting" class="menu-item setting"><span class="icon i-setting"></span><span class="menu-text">设置</span></li>
                        <li id="share" class="menu-item share"><span class="icon i-share"></span><span class="menu-text">分享</span></li>
                    </ul>
                </div>
            </div>
        </div>
        <!--首页结束-->

        <!--单元列表开始 -->
        <div class="page-box" id="units">
            <div class="page-header">
                <a href="#index"><i class="icon-home"></i></a>
                <h3>托福单词</h3>
            </div>

            <div class="page-content">
                <ul id="unit-wraper">
                </ul>
            </div>

        </div>
        <!--单元列表结束 -->

        <!--单词详情页开始 -->
        <div class="page-box" id="word">

            <div class="page-header">
                <a href="#units"><i class="icon-grid"></i></a>
                <h3>单词</h3>
            </div>

            <div class="page-content">
                <div class="outbox word-detail">
                    <div class="outbox-header">
                        <h3 id="cword"></h3>
                    </div>

                    <div class="outbox—content">
                        <p id="cpronounce">音标</p>
                        <p id="cmeaning">释义</p>
                        <div class="button-area">
                            <a class="btn"><i class="icon-sad"></i>&nbsp;不认识</a>
                            <a class="btn"><i class="icon-neutral"></i>&nbsp;有印象</a>
                            <a class="btn"><i class="icon-happy"></i>&nbsp;so easy</a>
                        </div>
                    </div>
                </div>
                
                <div class="outbox word-detail">
                    <div class="outbox-header">
                        <h3>例句</h3>
                    </div>

                    <div class="outbox—content">
                        <ul id="sentence">
                            
                        </ul>
                    </div>
                </div>
            </div>

            <div class="page-foot">
                <div class="nav">
                    <a id="prev" class="btn btn-red"><i class="icon-chevron-sign-left"></i>&nbsp上一个</a>
                    <a id="next" class="btn btn-red">下一个&nbsp;<i class="icon-chevron-sign-right"></i></a>
                </div>
            </div>

        </div>
        <!--单词详情页结束-->
    </div>


<script src="js/zepto.js"></script>
<script src="js/mobile.js"></script>
<script type="text/javascript">
    var DISPLAY_COUNT = 10;
    var cache = {};

/*
    window.wordInterface = {};
    window.wordInterface.getUnits = function(){return '[{"id":"0", "unit":"0", "yesRate":"0", "reviewLevel":"0", "studyFlag":"0", "lastWordIndex":"0"}, {"id":"1", "unit":"1", "yesRate":"0", "reviewLevel":"0", "studyFlag":"0", "lastWordIndex":"0"}, {"id":"2", "unit":"2", "yesRate":"0", "reviewLevel":"0", "studyFlag":"0", "lastWordIndex":"0"}, {"id":"3", "unit":"3", "yesRate":"0", "reviewLevel":"0", "studyFlag":"0", "lastWordIndex":"0"}, {"id":"4", "unit":"4", "yesRate":"0", "reviewLevel":"0", "studyFlag":"0", "lastWordIndex":"0"}]';}
    window.wordInterface.getWords = function(){return '[{"cword":"linxi", "cpronounce":"linxi", "cmeaning":"linxi"}, {"cword":"linxi2", "cpronounce":"linxi2", "cmeaning":"linxi2"}, {"cword":"linxi3", "cpronounce":"linxi3", "cmeaning":"linxi3"}]';}
    window.wordInterface.getWord = function(){return '{"word":"linxi", "pronounce":"linxi", "meaning":"linxi"}';}

    window.sentenceInterface = {};
    window.sentenceInterface.getSentence = function(){return '[{"sentences":"linxi|林溪一"}, {"sentences":"linxi2|林溪二"}, {"sentences":"linxi3|林溪三"}]';}
*/

    $('body').ready(function(){
        var wi = window.wordInterface,
            si = window.sentenceInterface;

        $('#debugInfo').text("success");

        var g = cache;
        g.currentUnit = 0;
        g.currentWord = 0;

        //记单词
        $('#wordunit').on('click', function(){
            
            M.navigate('#units');

            var template = '<li class="unit-item study_{{studyFlag}}" index="{{unit}}"><span class="unit">{{unit_label}}</span><span class="unit-desc"><p class="yesRate">{{yesRate}}</p><p class="level level-{{level}}"></p></span></li>';
            var units = JSON.parse(wi.getUnits());

            g.units = units;

            var par = $('#unit-wraper');
            par.empty();
            for(var i=0, len=units.length; i<len; i++){
                var un = units[i];
                var data = {
                    unit: un.unit,
                    unit_label: un.unit-0+1,
                    yesRate : un.yesRate,
                    level : un.reviewLevl,
                    studyFlag : un.studyFlag == 1 ? 'yes' : 'no'
                }

                par.append(M.render(template, data));
            }
        });

        $('#unit-wraper').delegate('.unit-item', 'click', function(e){
            
            M.navigate('#word');
            var g = cache;
            var tar = $(e.currentTarget);

            g.page = "#word";
            var unit = tar.attr('index');
            g.currentUnit = g.units[unit];
            g.currentWord = g.currentUnit.lastWordIndex-0;

            displayWord();
        });

        $('#prev').on('click', function(e){
            var g = cache;
            if(g.currentWord>1){
                g.currentWord--;
                displayWord();
            }
        });
        $('#next').on('click', function(e){
            var g = cache;
            if(g.currentWord<DISPLAY_COUNT){
                g.currentWord++;
                displayWord();
            }else{
                Dialog.alert('本单元已学习完成', function(){
                    $.mobile.navigate( "#p-unit" );
                    wi.addStudyLog(cache.currentUnit, Math.round(new Date().getTime()/1000)+'', 1, 0, 0);
                });
            }
        });

        function displayWord(){
            var g = cache;
            var result = wi.getWord(g.currentUnit.unit*DISPLAY_COUNT+g.currentWord+1);
            var cw =JSON.parse(result);

            $('#cword').html(cw.word);
            $('#cpronounce').html(cw.pronounce);
            $('#cmeaning').html(cw.meaning);

            var senResult = si.getSentence(cw.word);
            var sen =$.parseJSON(senResult);
            var par = $('#sentence');
            par.empty();
            for(var i=0, ii=sen.length; i<ii; i++){
                var str = sen[i].sentences;
                if(str && str != ''){
                    var arr = str.split('|');
                    if(arr.length > 1){
                        $('<li class="sentenceItem">'+ arr[0]+ '<br>'+ arr[1] +'</li>').appendTo(par);
                    }
                }
            }

        }
    });

</script>

</body>
</html>